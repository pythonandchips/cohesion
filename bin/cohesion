#!/usr/bin/env ruby

lib = File.expand_path(File.dirname(__FILE__) + '/../lib')
$LOAD_PATH.unshift(lib) if File.directory?(lib) && !$LOAD_PATH.include?(lib)

require 'cohesion'
require 'slop'

opts = Slop.parse(:help => true) do
  banner 'Usage: cohesion check [options]'

  on 'u', 'url', 'URL to start crawl from'
  on 'i', 'internal_urls', 'Url patterns to include', :as => Array
  on 'e', 'external_urls', 'Url patterns to exclude', :as => Array
  on 's', 'seed_urls', "Seed urls", :as => Array
  on 'v', 'verbose', 'Display crawl information'
  on 'd', 'debug', 'Display debug information'
  on 'l', 'crawl_limit', 'Limit the crawl to a number of urls'
  on 't', 'thread_count', "Set the number of threads used"
end

if opts[:url]
  failures = Cohesion::Check.site(opts[:url], opts)

  if failures.count == 0
    exit(true)
  else
    exit(false)
  end
else
  puts
end
